# 阶段二：视频导出方案讨论

## 方案 A: 浏览器端录制 (推荐首选)

这是最快捷、最简单的方案，所有处理都在用户的浏览器中完成，无需服务器。

*   **核心技术**:
    *   `html2canvas`: 用于实时“截图”网页内容到 `<canvas>` 元素。
    *   `MediaRecorder` API: 用于录制 `<canvas>` 的内容流。

*   **工作流程**:
    1.  在页面添加“开始录制”按钮。
    2.  点击后，从头播放对话动画。
    3.  在动画的每一帧，`html2canvas` 捕捉画面并更新到隐藏的 `canvas` 上。
    4.  `MediaRecorder` 持续录制 `canvas` 的内容。
    5.  播放结束后，停止录制，并生成一个 `.webm` 视频文件供用户下载。

*   **优点**:
    *   **实现简单**: 开发速度快。
    *   **无需服务器**: 成本低，无后端依赖。
    *   **即时反馈**: 用户可以立即获得视频文件。

*   **缺点**:
    *   **性能依赖用户**: 录制质量和流畅度受用户电脑配置影响。
    *   **格式有限**: 通常只能导出 `.webm` 格式。

---

## 方案 B: 服务器端渲染 (使用 FFmpeg)

这是最强大、最工业化的解决方案，视频的生成���全在服务器上完成。

*   **核心理念**: 将对话数据发送到服务器，服务器使用强大的视频处理工具 FFmpeg 从零开始合成每一帧画面。

*   **工作流程**:
    1.  前端发送对话的 JSON 数据到后端 API。
    2.  后端服务器根据数据动态生成一个复杂的 FFmpeg 命令。
    3.  FFmpeg 命令会像图层一样，将背景、头像、高亮效果、字幕等元素在正确的时间合成到视频帧上。
    4.  FFmpeg 执行命令，编码成一个高质量的 MP4 文件。
    5.  任务完成后，通知前端，用户即可下载。

*   **优点**:
    *   **质量极高**: 可以完全控制视频的分辨率、码率、格式 (MP4, MOV 等)。
    *   **稳定可靠**: 结果不依赖用户电脑，每次生成都完全一致。
    *   **功能强大**: 未来可以轻松加入转场动画、背景音乐等复杂效果。

*   **缺点**:
    *   **复杂度最高**: 需要开发和维护后端服务器及 FFmpeg 环境。
    *   **处理耗时**: 用户需要等待后台处理，无法立即获得结果。
    *   **成本更高**: 需要服务器计算资源。

---

## 方案 C: 无头浏览器自动化 (Puppeteer / Playwright)

这是一个介于方案 A 和 B 之间的折中方案，将浏览器录制过程搬到了服务器上自动化进行。

*   **核心理念**: 在服务器上运行一个看不见的、被程序控制的浏览器，让它打开网页、播放动画，并逐帧截图，最后将截图合成为视频。

*   **工作流程**:
    1.  服务器启动一个“无头浏览器”实例并打开应用页面。
    2.  服务器通过控制脚本“点击”播放按钮。
    3.  脚本以固定帧率对页面进行截图，保存为序列帧图片。
    4.  动画播放完毕后，使用 FFmpeg 将这些图片序列合成为一个视频文件。

*   **优点**:
    *   **所见即所得**: 视频内容和在浏览器中看到的效果完全一致。
    *   **逻辑复用**: 无需重写渲染逻辑，所有动画效果依然由 Vue 组件负责。
    *   **稳定可靠**: 在统一的服务器环境中运行，结果一致。

*   **缺点**:
    *   **资源消耗大**: 运行一个完整的浏览器实例非常消耗服务器的 CPU 和内存。
    *   **过程可能很慢**: 截图、保存、再合成，整个流程可能比方案 B 更慢。
    *   **脚本脆弱**: 自动化脚本和页面结构耦合度高，前端改动可能导致脚本失效。

---

### 总结对比

| 特性 | **方案A: 浏览器录制 (推荐起点)** | **方案B: 服务器渲染 (最强)** | **方案C: 无头浏览器 (折中)** |
| :--- | :--- | :--- | :--- |
| **复杂度** | **低** | **高** | **中** |
| **运行环境** | 用户浏览器 | 后端服务器 + FFmpeg | 后端服务器 + 无头浏览器 + FFmpeg |
| **视频质量** | 中 (依赖用户电脑) | **高** | 高 |
| **格式控制** | 低 (通常是 .webm) | **高** | 中 |
| **可靠性** | 低 | **高** | 高 |
| **开发速度** | **快** | 慢 | 中 |
| **成本** | **无** | 高 | 中 |
